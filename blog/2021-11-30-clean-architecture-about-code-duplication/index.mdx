---
title: "«Чистая архитектура»: про дублирование кода"
tags: [books, Чистая архитектура, Robert C. Martin]
---

Знал бы я три года назад, что не каждое дублирование нужно устранять, сэкономил бы кучу времени своей команды и команды тестировщиков. Расскажу одну историю.

## Пример из практики

Был у нас в matchtv.ru маленький компонент с счетом футбольного матча и названиями играющих команд. Этот компонент использовался в десятках мест на сайте, и везде выглядел немножко иначе:

| Светлая тема | Темная тема |
|:------|:------|
| ![](1.png) | ![](4.png) |
| ![](2.png) | ![](6.png) |
| ![](3.png) | ![](7.png) |
| ![](5.png) | ![](8.png) |

Компонент изначально казался таким простым, что при каждом новом запросе от бизнеса мы добавляли условия в коде компонента и немного меняли его поведение:
- Выводить ли полную дату или только время?
- А может вообще не показывать дату?
- Логотип команды справа или слева от названия команды?
- Отображать пенальти или нет?
- Показывать страну команды или нет?
- А шрифт большой или маленький?
- А крестик у будущего матча вместо счета или прочерки?

В итоге компонент из 30 строк разросся до 300, и каждая новая правка для матча на одной странице ломала отображение матча на других страницах. И тогда мы создали независимую копию компонента для каждой конкретной задачи, чтобы наши правки не ломали матчи.

## Мнение эксперта

Вот, что Роберт Мартин говорит об этом в своей книге:

<figure>
    <blockquote>
        <p>Архитекторы часто попадают в ловушку, зависящую от их страха перед дублированием.</p>
        <p>Вообще в программном обеспечении считается, что дублирования следует избегать. Мы стараемся предотвратить дублирование программного кода. Когда обнаруживается действительно повторяющийся код, мы с благоговением смотрим, как профессионалы устраняют его.</p>
        <p>Но есть разные виды дублирования. Есть истинное дублирование, когда любое изменение в одной копии требует того же изменения во всех остальных копиях. А есть ложное дублирование. Если два фрагмента кода, кажущиеся одинаковыми, развиваются разными путями — если они изменяются с разной скоростью и по разным причинам — этот случай не является истинным дублированием. Вернитесь к ним через несколько лет, и вы увидите, что они совершенно не похожи друг на друга.</p>
    </blockquote>
    <figcaption>— Р. Мартин, <cite>«Чистая архитектура»</cite></figcaption>
</figure>
